<?xml version="1.0"?>
<project name="Runs the OpenJPA enhancer" basedir=".">

<taskdef name="openjpac" classname="org.apache.openjpa.ant.PCEnhancerTask">
	<classpath>
		<fileset dir="../extra/tools-lib" id="tooljars">
			<include  name="*.jar" />
		</fileset>
	</classpath>
</taskdef>

<taskdef name="mappingtool" classname="org.apache.openjpa.jdbc.ant.MappingToolTask">
	<classpath>
		<fileset refid="tooljars" />
	</classpath>
</taskdef>

<target name="enhance" description="Calls the openjpa enhancer ant task on all classed in gndms-shared-model/production">
	<openjpac directory="gndms-shared-model/production">
		<config propertiesFile="src/META-INF/persistence.xml" />

		<classpath>
			<pathelement location="gndms-shared-model/production" />
			<fileset refid="tooljars" />
		</classpath>

		<fileset dir="gndms-shared-model/production">
			<include name="de/zib/gndms/model/**/*" />
			<exclude name="de/zib/gndms/model/*" />
			<exclude name="de/zib/gndms/model/util/*" />
			<exclude name="de/zib/gndms/model/*/types/*" />
		</fileset>
		
	</openjpac>
</target>

<target name="map" description="Calls the OpenJPA mapping tool to build the current schema">
	<mappingtool schemaaction="build"
	             indexes="true" foreignkeys="true" primarykeys="true"
	             sqlfile="stdout">
		<config
			  connectionDriverName="org.apache.derby.jdbc.EmbeddedDriver"
			  connectionURL="jdbc:derby:/opt/gt-current/etc/c3grid_shared/db/c3grid"
			  propertiesFile="src/META-INF/persistence.xml"  />

		<classpath>
			<pathelement location="gndms-shared-model/production" />
			<fileset refid="tooljars" />
		</classpath>

		<fileset dir="gndms-shared-model/production">
			<include name="de/zib/gndms/model/**/*" />
			<exclude name="de/zib/gndms/model/*" />
			<exclude name="de/zib/gndms/model/util/*" />			
			<exclude name="de/zib/gndms/model/*/types/*" />
		</fileset>
	</mappingtool>
</target>
</project>