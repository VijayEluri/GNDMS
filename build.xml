<project name="c3grid" default="help" basedir="." >
	
	
	<!-- Define the environment variable -->
	<property environment="env"/>
	
	<!-- Jars -->
	<property name="tools-lib.dir" value="extra/tools-lib" />
	<property name="lib.dir" value="extra/lib" />
	
	
	
	<!-- Source-Code directories of each package-->
	<property name="model.dir" value="model"/>
	<property name="kit.dir" value="kit"/>
	<property name="logic.dir" value="logic"/>
	<property name="infra.dir" value="infra"/>
	<property name="typecon.dir" value="typecon"/>
		
	<!-- Directories of Build-files  -->
	<property name="model.dest" value="${model.dir}/gndms-shared-model"/>
	<property name="kit.dest" value="${kit.dir}/gndms-kit"/>
	<property name="logic.dest" value="${logic.dir}/gndms-logic"/>
	<property name="infra.dest" value="${infra.dir}/gndms-infra"/>
	<property name="typecon.dest" value="${typecon.dir}/gndms-typecon"/>
	
	<!-- To avoid problems import just libaries defined in globus_jars.txt-->
	<fileset dir="${env.GLOBUS_LOCATION}/lib" includesfile="globus_jars.txt" id="globus.lib"/>

	
	<!-- using ant contrib for contidionals, looping , and runtarget -->
	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
			<pathelement location="${tools-lib.dir}/ant-contrib.jar" />
		</classpath>
	</taskdef>
		
	<!-- Import deployment file of each package-->
	<import file="${model.dir}/build.xml"/>	
	<import file="${kit.dir}/build.xml"/>
	<import file="${logic.dir}/build.xml"/>
	<import file="${infra.dir}/build.xml"/>
	<import file="${typecon.dir}/build.xml"/>
	
	<path id="groovy.path">
		<fileset file="extra/tools-lib/groovy-all-1.6-beta-1.jar"/>
	</path>
	
	<!-- using groovc as groovy compiler in ant-->
	<taskdef name="groovyc" classname="org.codehaus.groovy.ant.Groovyc" classpathref="groovy.path" />
	
	
	<!-- Sets all necessary settings and builds the whole project -->
	<target name="deploy" description="Sets all necessary settings and builds the whole project">
		<runtarget target="stubs.compile"/>
		<runtarget target="symlink"/>
		<runtarget target="compile"/>
		<runtarget target="services.compile"/>
	</target>
	
	<!-- Delete build-files and jars of every package -->
	<target name="clean" description="deletes jar and build-files of every package">
		<runtarget target="infra.clean"/>
		<runtarget target="typecon.clean"/>
		<runtarget target="logic.clean"/>
		<runtarget target="kit.clean"/>
		<runtarget target="model.clean"/>
	</target>
	
	<!-- Compiles the whole project. Use this only if target 'deploy' has been invoked once ! -->
	<target name="compile">
		<runtarget target="model.jar"/>
		<runtarget target="model.enhancer"/>
		<runtarget target="kit.jar"/>
		<runtarget target="logic.jar"/>
		<runtarget target="typecon.jar"/>
		<runtarget target="infra.jar"/>
	</target>
	
	
	<!-- Compiles the whole project. Use this only if target 'deploy' has been invoked once ! -->
	<target name="compile.all" depends="compile">
		<runtarget target="model.compile.all"/>
		<runtarget target="kit.compile.all"/>
		<runtarget target="logic.compile.all"/>
		<runtarget target="typecon.compile.all"/>
		<runtarget target="infra.compile.all"/>
	</target>
	<!-- Compiles the whole project with test files. Use this only if target 'deploy' has been invoked once ! -->
	<target name="compile.test">
		<runtarget target="model.compile.all"/>
		<runtarget target="model.enhancer"/>
		<runtarget target="kit.compile.all"/>
		<runtarget target="logic.compile.all"/>
		<runtarget target="typecon.compile.all"/>
		<runtarget target="infra.compile.all"/>
	</target>
	<!-- Building stubs for every service -->
	<target name='stubs.compile'>
		<exec executable="sh">
			<arg value="-c"/>
			<arg value="for i in services/* ; do ( cd $i &amp;&amp; ant compileStubs ) ; done"/>
		</exec>
	</target>
	
	<!-- Building all services -->
	<target name='services.compile'>
		<exec executable="sh">
			<arg value="-c"/>
			<arg value="for i in services/* ; do ( cd $i &amp;&amp; ant createDeploymentGar ) ; done"/>
		</exec>
	</target>
	<!-- Create necessary symlinks in the services' lib directories -->
	<target name="symlink">
		<exec executable="sh">
			<arg value="sync.sh"/>
		</exec>
	</target>
	
	<!-- To deploy gar files -->
	<target name="gar.deploy" if="filename" description="Deploy a gar file using 'ant gar.deploy -Dfilename=x' , where x is the path of the file">
		<exec executable ="globus-deploy-gar">
			<arg value="${filename}" />
		</exec>
	</target>
	
	<target name="help" description="Prints usage information.">
		<echo message="================================================================================" />
		<echo message="|                      C3Grid Deployment                                       |" />
		<echo message="|                                                                              |" />
		<echo message="--------------------------------------------------------------------------------" />
		<echo message="|  USAGE:                                                                      |" />
		<echo message="|    Type 'ant -h' for general help with Ant                                   |" />
		<echo message="|    Type 'ant -p' for a description of available build targets.               |" />
		<echo message="|    Type 'ant deploy' to generate needed binaries and set configuartions      |" />
		<echo message="|    Type 'ant compile' for generating needed binaries                         |" />
		<echo message="|    Type 'ant clean' for deleting all generated binaries and jars             |" />
		<echo message="|    Type 'ant compile.all' to compile all source-codes and test files         |" />
		<echo message="|    Type 'ant gar.deploy -Dfilename=path' for deploying a gar file located    |" />
		<echo message="|                                          in path                             |" />
		<echo message="================================================================================" />
	</target>
	
	
</project>